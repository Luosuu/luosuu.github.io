<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Sight Reading Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .game-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 25px;
            width: 90%;
            max-width: 800px;
        }
        .staff {
            position: relative;
            width: 700px;
            height: 400px;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: #fff;
            border-radius: 5px;
            padding: 10px 0;
        }
        .line {
            width: 100%;
            height: 3px;
            background-color: black;
        }
        .note {
            position: absolute;
            width: 150px;
            height: auto;
            transition: opacity 0.3s;
        }
        .note-animation {
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }
        .buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-top: 30px;
            max-width: 700px;
        }
        button {
            padding: 12px 20px;
            font-size: 18px;
            cursor: pointer;
            border: 2px solid #3498db;
            background-color: white;
            color: #3498db;
            border-radius: 5px;
            transition: all 0.2s;
        }
        button:hover {
            background-color: #3498db;
            color: white;
        }
        .stats-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin: 20px 0;
        }
        .score, .timer {
            margin-top: 20px;
            font-size: 22px;
            font-weight: bold;
            color: #2c3e50;
            padding: 10px 15px;
            background-color: #f1f1f1;
            border-radius: 5px;
        }
        .feedback {
            margin: 20px 0;
            font-size: 20px;
            height: 30px;
            text-align: center;
            font-weight: bold;
        }
        .controls {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .game-button {
            padding: 15px 25px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .game-button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .settings {
            margin-top: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            width: 100%;
        }
        .difficulty {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        .difficulty label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            cursor: pointer;
        }
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        .streak {
            color: #e67e22;
        }
        .correct-answer {
            animation: correctPulse 0.6s;
        }
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .wrong-answer {
            animation: wrongShake 0.5s;
        }
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .keyboard-shortcuts {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Music Sight Reading Game</h1>
    
    <div class="game-container">
        <div class="staff">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
            <div id="note-display"></div>
        </div>
        
        <div class="stats-container">
            <div class="score">Score: <span id="score">0</span></div>
            <div class="timer">Time: <span id="timer">0</span>s</div>
        </div>
        
        <div class="feedback" id="feedback"></div>
        
        <div class="buttons">
            <button onclick="checkAnswer('c')">C</button>
            <button onclick="checkAnswer('d')">D</button>
            <button onclick="checkAnswer('e')">E</button>
            <button onclick="checkAnswer('f')">F</button>
            <button onclick="checkAnswer('f_2')">F (alt)</button>
            <button onclick="checkAnswer('g')">G</button>
            <button onclick="checkAnswer('g_2')">G (alt)</button>
            <button onclick="checkAnswer('a')">A</button>
            <button onclick="checkAnswer('b')">B</button>
        </div>
        
        <div class="settings">
            <div class="difficulty">
                <label>
                    <input type="checkbox" id="easy-mode" checked> 
                    <span>Easy Mode (C, D, E only)</span>
                </label>
                
                <label>
                    <input type="checkbox" id="animations-enabled" checked> 
                    <span>Enable Animations</span>
                </label>
            </div>
            
            <div class="keyboard-shortcuts">
                Keyboard shortcuts: Press C, D, E, F, G, A, B keys to select notes
            </div>
        </div>
        
        <div class="controls">
            <button class="game-button" onclick="startGame()">Start New Game</button>
            <button class="game-button" onclick="toggleHelp()">Help</button>
        </div>
    </div>
    
    <script>
        let currentNote = '';
        let score = 0;
        let streak = 0;
        let timer = 0;
        let timerInterval;
        let gameRunning = false;
        let helpVisible = false;
        
        const notePositions = {
            // Updated positions for the much larger staff
            'c': '290px',   // Middle C position
            'd': '260px',   // D position
            'e': '230px',   // E position
            'f': '200px',   // F position
            'f_2': '200px', // F alt position
            'g': '170px',   // G position
            'g_2': '170px', // G alt position
            'a': '140px',   // A position
            'b': '110px'    // B position
        };
        
        function getAvailableNotes() {
            const easyMode = document.getElementById('easy-mode').checked;
            if (easyMode) {
                return ['c', 'd', 'e'];
            } else {
                return ['c', 'd', 'e', 'f', 'f_2', 'g', 'g_2', 'a', 'b'];
            }
        }
        
        function displayRandomNote() {
            // Force the function to recognize the current state of the checkbox
            const availableNotes = getAvailableNotes();
            
            const randomIndex = Math.floor(Math.random() * availableNotes.length);
            currentNote = availableNotes[randomIndex];
            
            const noteDisplay = document.getElementById('note-display');
            noteDisplay.innerHTML = '';
            
            const noteImg = document.createElement('img');
            noteImg.src = `/assets/musical_notes/${currentNote === 'c' ? 'middle_c.png' : 'note_' + currentNote + '.png'}`;
            noteImg.classList.add('note');
            
            // Add animation if enabled
            if (document.getElementById('animations-enabled').checked) {
                noteImg.classList.add('note-animation');
            }
            
            noteImg.style.top = notePositions[currentNote];
            noteImg.style.left = '275px';
            noteImg.id = 'current-note-img';
            
            noteDisplay.appendChild(noteImg);
            
            document.getElementById('feedback').textContent = '';
        }
        
        function checkAnswer(answer) {
            if (!currentNote || !gameRunning) return;
            
            const feedback = document.getElementById('feedback');
            const noteImg = document.getElementById('current-note-img');
            
            // Compare the base note (ignoring _2 suffix for alternative versions)
            const baseNote = currentNote.split('_')[0];
            const baseAnswer = answer.split('_')[0];
            
            if (baseNote === baseAnswer) {
                // Correct answer
                score++;
                streak++;
                document.getElementById('score').textContent = score;
                
                feedback.textContent = streak > 1 ? 
                    `Correct! ${streak} note streak!` : 'Correct!';
                feedback.style.color = '#27ae60';
                
                if (document.getElementById('animations-enabled').checked) {
                    noteImg.classList.add('correct-answer');
                }
            } else {
                // Wrong answer
                streak = 0;
                feedback.textContent = `Wrong! That was ${baseNote.toUpperCase()}`;
                feedback.style.color = '#e74c3c';
                
                if (document.getElementById('animations-enabled').checked) {
                    noteImg.classList.add('wrong-answer');
                }
            }
            
            // Show the next note after a delay
            setTimeout(displayRandomNote, 1000);
        }
        
        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            timer = 0;
            document.getElementById('timer').textContent = timer;
            
            timerInterval = setInterval(() => {
                timer++;
                document.getElementById('timer').textContent = timer;
            }, 1000);
        }
        
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
        
        function startGame() {
            // Reset game state
            score = 0;
            streak = 0;
            gameRunning = true;
            document.getElementById('score').textContent = score;
            
            // Start the timer
            startTimer();
            
            // Display the first note
            displayRandomNote();
        }
        
        function toggleHelp() {
            helpVisible = !helpVisible;
            
            if (helpVisible) {
                const helpContent = document.createElement('div');
                helpContent.id = 'help-panel';
                helpContent.style.position = 'fixed';
                helpContent.style.top = '50%';
                helpContent.style.left = '50%';
                helpContent.style.transform = 'translate(-50%, -50%)';
                helpContent.style.backgroundColor = 'white';
                helpContent.style.padding = '20px';
                helpContent.style.borderRadius = '10px';
                helpContent.style.boxShadow = '0 0 20px rgba(0,0,0,0.3)';
                helpContent.style.maxWidth = '500px';
                helpContent.style.width = '90%';
                helpContent.style.zIndex = '1000';
                
                helpContent.innerHTML = `
                    <h2>How to Play</h2>
                    <p>This game helps you practice identifying musical notes on a staff.</p>
                    <ul>
                        <li>A random note will appear on the staff</li>
                        <li>Click the button showing the correct note name</li>
                        <li>You can also press the corresponding keyboard key (C, D, E, etc.)</li>
                        <li>Easy mode shows only C, D, and E notes</li>
                    </ul>
                    <h3>Notes Included:</h3>
                    <p>C (middle C), D, E, F, G, A, and B</p>
                    <p>Some notes have alternative versions (like F and G)</p>
                    <button id="close-help" style="margin-top: 20px; padding: 10px 15px;">Close Help</button>
                `;
                
                document.body.appendChild(helpContent);
                
                document.getElementById('close-help').addEventListener('click', toggleHelp);
            } else {
                const helpPanel = document.getElementById('help-panel');
                if (helpPanel) {
                    helpPanel.remove();
                }
            }
        }
        
        // Add keyboard shortcuts
        function handleKeyPress(e) {
            if (!gameRunning) return;
            
            const key = e.key.toLowerCase();
            
            switch(key) {
                case 'c':
                    checkAnswer('c');
                    break;
                case 'd':
                    checkAnswer('d');
                    break;
                case 'e':
                    checkAnswer('e');
                    break;
                case 'f':
                    checkAnswer('f');
                    break;
                case 'g':
                    checkAnswer('g');
                    break;
                case 'a':
                    checkAnswer('a');
                    break;
                case 'b':
                    checkAnswer('b');
                    break;
            }
        }
        
        // Initialize event handlers when the page is fully loaded
        window.onload = function() {
            // Add event listener for the checkbox
            document.getElementById('easy-mode').addEventListener('change', function() {
                // Reset the game with the new mode
                startGame();
            });
            
            // Add event listener for animations toggle
            document.getElementById('animations-enabled').addEventListener('change', function() {
                // No need to restart, just update the setting
                const noteImg = document.getElementById('current-note-img');
                if (noteImg) {
                    if (this.checked) {
                        noteImg.classList.add('note-animation');
                    } else {
                        noteImg.classList.remove('note-animation');
                    }
                }
            });
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', handleKeyPress);
            
            // Start the game initially
            startGame();
        };
    </script>
</body>
</html>